{"id":"detergent-0mo","title":"Change status --follow to only refresh when state changes to avoid flickering","status":"closed","priority":2,"issue_type":"bug","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:02:10.062297Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:07:51.110758Z","closed_at":"2026-02-14T22:07:51.110758Z","close_reason":"Closed"}
{"id":"detergent-0qe","title":"permissions","description":"allow detergent.yaml to define a block of permissions that matches the Claude Code permissions configuration found in .claude/settings.json. We can write this file in eeach temp working directory that we invoke Claude Code in for each concern. It should be optional.\n","status":"closed","priority":3,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T07:40:34.164241Z","created_by":"Daniel Jones","updated_at":"2026-02-15T07:46:15.32877Z","closed_at":"2026-02-15T07:46:15.32877Z","close_reason":"Closed"}
{"id":"detergent-0tn","title":"ci integration tests","description":"assuming that we actually have integration tests, make sure they are invoked in CI, and that the job passes in CLAUDE_CODE_OAUTH_TOKEN","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:49:48.024282Z","created_by":"Daniel Jones","updated_at":"2026-02-15T11:07:01.132622Z","closed_at":"2026-02-15T11:07:01.132622Z","close_reason":"Integration job now runs acceptance tests with CLAUDE_CODE_OAUTH_TOKEN from secrets. Ready for Claude-based integration tests when written."}
{"id":"detergent-32t","title":"settings refresh","description":"change detergent run to poll/watch the settings files for changes, and reconfigure itself dynamically.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T08:39:40.794626Z","created_by":"Daniel Jones","updated_at":"2026-02-15T10:26:21.429003Z","closed_at":"2026-02-15T10:26:21.429003Z","close_reason":"Daemon now reloads config every poll cycle. Invalid configs logged and skipped. Poll interval changes reset the ticker automatically. 75/75 tests pass."}
{"id":"detergent-3fv","title":"Remove unused/dead code","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T08:33:46.51963Z","created_by":"Daniel Jones","updated_at":"2026-02-15T08:59:52.518369Z","closed_at":"2026-02-15T08:59:52.518369Z","close_reason":"No dead code found. Both deadcode and staticcheck tools report clean. All 74 acceptance tests pass. Manual analysis confirmed all functions, types, variables, and constants are reachable and used."}
{"id":"detergent-4uo","title":"remove any dead code","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:25:41.970177Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:28:22.150757Z","closed_at":"2026-02-14T22:28:22.150757Z","close_reason":"Closed"}
{"id":"detergent-69j","title":"update readme","description":"update the readme to ensure all features are documented","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:24:17.538241Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:33:08.965642Z","closed_at":"2026-02-14T22:33:08.965642Z","close_reason":"Closed"}
{"id":"detergent-6c5","title":"GitHub Copilot CLI statusline integration","description":"Add detergent statusline support for GitHub Copilot CLI. Copilot CLI can run a script at a configurable interval and render output as a status line below the chat input. Status line issue: https://github.com/github/copilot-cli/issues/1311 — Status sidebar discussion: https://github.com/github/copilot-cli/issues/981","status":"closed","priority":2,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-15T16:50:41.4567Z","created_by":"Daniel Jones","updated_at":"2026-02-17T09:03:20.29522Z","closed_at":"2026-02-17T09:03:20.29522Z","close_reason":"Copilot CLI has no statusline extensibility. Feature request #1311 is open with no maintainer response yet."}
{"id":"detergent-7gp","title":"Remove unused code (deadcode sweep)","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T08:23:42.875037Z","created_by":"Daniel Jones","updated_at":"2026-02-15T08:54:50.418474Z","closed_at":"2026-02-15T08:54:50.418474Z","close_reason":"No dead code found. Both deadcode and staticcheck tools report clean. Manual analysis confirmed all functions, types, variables, and constants are reachable and used."}
{"id":"detergent-7vk","title":"ci","description":"release should only follow successful integration tests in ci","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:48:29.948903Z","created_by":"Daniel Jones","updated_at":"2026-02-15T11:07:01.169872Z","closed_at":"2026-02-15T11:07:01.169872Z","close_reason":"Release job now depends on [lint, test, build, integration]. Release won't proceed until integration tests pass."}
{"id":"detergent-84l","title":"website","description":"Clone git@github.com:re-cinq/wave.git and look at its website - I tihnk it's in Docs. Create an aesthetically-matching equivalent for detergent, but don't deploy it anywhere. Figure out how Wave deploys its site, and then use plan mode to describe the various ways we could make a low-effort site deployment. Write this to our repo, but don't commit it.","status":"closed","priority":4,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T06:55:27.698509Z","created_by":"Daniel Jones","updated_at":"2026-02-15T16:41:09.738487Z","closed_at":"2026-02-15T16:41:09.738487Z","close_reason":"Website created in docs/ matching Wave aesthetic. Content pages: index, guide, getting-started, configuration, claude-code. Deployment plan written to docs/DEPLOYMENT.md covering GitHub Pages, Cloudflare Pages, Netlify, Vercel. Not committed per issue instructions."}
{"id":"detergent-8lj","title":"Codex CLI statusline integration","description":"Add detergent statusline support for OpenAI Codex CLI. Codex has built-in /statusline command with configurable items via config.status_line.items. Docs: https://developers.openai.com/codex/cli/features/ — Status line rendering: https://deepwiki.com/openai/codex/4.1.4-status-line-and-footer-rendering","status":"closed","priority":1,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-15T16:50:40.32785Z","created_by":"Daniel Jones","updated_at":"2026-02-17T09:02:33.862383Z","closed_at":"2026-02-17T09:02:33.862383Z","close_reason":"Codex CLI statusline is a closed system - only supports built-in StatusLineItem enum variants (model, approval, sandbox, branch, etc). No protocol for custom/external status line items. Would require upstream contribution to Codex CLI to add extensibility support."}
{"id":"detergent-9pe","title":"status follow logs","description":"I'm not sure the logs are scrolling properly in status follow mode. I was kinda expecting to see a 'window' of three lines scrolling within the status follow output. I think maybe it's not refreshing, because of the previous instruction to only update the view when status changes? We'll need to instead redraw whenever the logs change too.\n","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T06:58:25.252257Z","created_by":"Daniel Jones","updated_at":"2026-02-15T07:34:18.737634Z","closed_at":"2026-02-15T07:34:18.737634Z","close_reason":"Closed"}
{"id":"detergent-a0g","title":"Rename 'detergent' to \u003cNEW_NAME\u003e","description":"## Context\n\nThe tool name \"detergent\" is hard to type. No external users exist yet, so this is a clean rename with no migration concerns. The name appears ~1,100 times across ~71 files, but most changes are mechanical find-and-replace.\n\nBefore executing, we need the new name. Use \u003cNEW_NAME\u003e as a placeholder until the name is chosen.\n\n## Steps\n\n### 1. Choose the new name\n- User provides the replacement name before execution begins\n\n### 2. Rename directories\n- `cmd/detergent/` → `cmd/\u003cNEW_NAME\u003e/`\n- `.claude/skills/detergent-rebase/` → `.claude/skills/\u003cNEW_NAME\u003e-rebase/`\n- `.claude/skills/detergent-start/` → `.claude/skills/\u003cNEW_NAME\u003e-start/`\n- `internal/assets/skills/detergent-rebase/` → `internal/assets/skills/\u003cNEW_NAME\u003e-rebase/`\n- `internal/assets/skills/detergent-start/` → `internal/assets/skills/\u003cNEW_NAME\u003e-start/`\n- `openspec/specs/detergent/` → `openspec/specs/\u003cNEW_NAME\u003e/`\n\n### 3. Update Go module path\n- `go.mod`: `github.com/re-cinq/detergent` → `github.com/re-cinq/\u003cNEW_NAME\u003e`\n- All import statements in `.go` files (use `goimports` or scripted replacement)\n\n### 4. Global find-and-replace in source files\nCase-sensitive replacements across all `.go`, `.yaml`, `.yml`, `.md`, `.ts`, `.sh`, `.json` files:\n- `detergent` → `\u003cNEW_NAME\u003e` (lowercase)\n- `Detergent` → `\u003cNEW_NAME_CAPITALIZED\u003e` (title case, used in docs/VitePress)\n- `.detergent/` → `.\u003cNEW_NAME\u003e/` (runtime directory)\n- `detergent.yaml` / `detergent.yml` → `\u003cNEW_NAME\u003e.yaml` / `\u003cNEW_NAME\u003e.yml`\n\n### 5. Update build/release config\n- `Makefile`: `BINARY_NAME := detergent` → `BINARY_NAME := \u003cNEW_NAME\u003e`\n- `.goreleaser.yaml`: binary name, project name, ldflags paths\n- `.github/workflows/ci.yml`: build references\n- `scripts/install.sh`: `REPO=\"re-cinq/detergent\"` and all references\n\n### 6. Update skill definitions\n- Skill names in `SKILL.md` files (`detergent-rebase` → `\u003cNEW_NAME\u003e-rebase`, etc.)\n- Embedded skill references in `internal/assets/`\n- Statusline command in `internal/cli/statusline.go` and `internal/cli/init.go`\n\n### 7. Update documentation\n- `README.md`\n- `docs/` VitePress site (config.ts title, all guide pages)\n- `docs/package.json` name field\n- `PLAN.md`, `openspec/config.yaml`\n\n### 8. Update beads/issue tracker references\n- `.beads/issues.jsonl` contains \"detergent\" in descriptions — update or leave as historical\n\n### 9. Rename GitHub repo\n- Rename `re-cinq/detergent` → `re-cinq/\u003cNEW_NAME\u003e` on GitHub (manual step)\n\n### 10. Verify\n- `go build ./...` — confirms module path and imports are consistent\n- `go test ./...` — runs all unit tests\n- Run acceptance tests: `make test-acceptance` (or equivalent)\n- `go vet ./...` — static analysis\n- Grep for any remaining `detergent` occurrences (expect zero outside git history and `.beads/` historical entries)\n\n## Key files to modify\n- `go.mod`\n- `cmd/detergent/main.go`\n- `internal/cli/root.go`, `internal/cli/init.go`, `internal/cli/statusline.go`\n- `internal/cli/*.go` (all ~13 files)\n- `internal/engine/*.go`\n- `internal/config/*.go`\n- `internal/git/git.go`\n- `Makefile`, `.goreleaser.yaml`, `.github/workflows/ci.yml`\n- `scripts/install.sh`\n- `.claude/skills/detergent-*/SKILL.md`\n- `internal/assets/skills/detergent-*/SKILL.md`\n- `docs/.vitepress/config.ts`, `docs/package.json`\n- `docs/*.md`, `README.md`\n- `openspec/config.yaml`, `openspec/specs/detergent/spec.md`\n\n## Approach\nMost of this is a scripted sed/rename pass followed by manual verification. The Go import rewrite is the most error-prone part — do a `go build` immediately after to catch any mistakes. Total execution is ~1 session of focused work.","status":"open","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-19T15:22:07.202116Z","created_by":"Daniel Jones","updated_at":"2026-02-19T15:22:07.202116Z"}
{"id":"detergent-aw3","title":"status colours","description":"Can we have  use the same colours as the statusline? Especially in follow mode?","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T06:56:34.594716Z","created_by":"Daniel Jones","updated_at":"2026-02-15T07:25:38.0174Z","closed_at":"2026-02-15T07:25:38.0174Z","close_reason":"Closed"}
{"id":"detergent-b6a","title":"Deduplicate repeated error wrapping patterns","description":"Extract common fmt.Errorf wrapping patterns into helper functions. Found 20+ occurrences across engine/state.go, engine/engine.go, config/config.go, and cli/install.go. Create internal/errors package with context-aware error wrapping.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:05:38.31066Z","created_by":"Daniel Jones","updated_at":"2026-02-15T10:24:58.677387Z","closed_at":"2026-02-15T10:24:58.677387Z","close_reason":"Premature abstraction. These are 2-3 line idiomatic Go patterns (MkdirAll+WriteFile, os.IsNotExist, fmt.Errorf). Creating helpers adds indirection without meaningful benefit at this codebase size."}
{"id":"detergent-bv9","title":"debugging","description":"Make it easier to figure out why nothing seems to be happening. Do we know where logs, STDOUT and STDERR for each invocation go? Maybe we can add a `detergent logs \u003cconcern\u003e \u003ccommit\u003e` command or something to open those in a convenient fashion? Ooh! Maybe we could also have `detergent status -f` tail the last few lines of the logs?\n","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:30:56.231535Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:49:10.26889Z","closed_at":"2026-02-14T22:49:10.26889Z","close_reason":"Closed"}
{"id":"detergent-d96","title":"Remove dead code from codebase","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T08:24:49.096755Z","created_by":"Daniel Jones","updated_at":"2026-02-15T08:33:22.085254Z","closed_at":"2026-02-15T08:33:22.085254Z","close_reason":"No dead code found. Both deadcode and staticcheck tools report clean. Manual analysis confirmed all functions, types, variables, and constants are reachable and used."}
{"id":"detergent-e5q","title":"Auto-inject non-interactive preamble into agent prompts","description":"Detergent knows the agent is always non-interactive, so it should automatically prepend something like 'You are running non-interactively. Do not ask questions or wait for confirmation.' to every concern prompt. This removes the burden from users having to include it manually in every prompt.","status":"closed","priority":3,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:06:35.515433Z","created_by":"Daniel Jones","updated_at":"2026-02-15T16:40:20.680719Z","closed_at":"2026-02-15T16:40:20.680719Z","close_reason":"Removed redundant non-interactive preambles from concern prompts in detergent.yaml since they are now auto-injected by assembleContext()"}
{"id":"detergent-ef9","title":"Status command should validate PID liveness for active states","description":"The status and statusline commands trust the state field in the status JSON, but if the daemon crashes or is killed mid-run, the file still says agent_running forever. Since the PID is already recorded, check if the process is still alive (kill -0) and show a stale/crashed state if it's dead. Affects states: change_detected, agent_running, committing.","status":"closed","priority":2,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:43:04.145197Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:47:12.83066Z","closed_at":"2026-02-14T22:47:12.83066Z","close_reason":"Closed"}
{"id":"detergent-ekp","title":"status follow logs","description":"Make sure the log tail in status -f doesn't show any logs from previous runs; it's confusing.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-16T21:29:55.02112Z","created_by":"Daniel Jones","updated_at":"2026-02-16T21:52:47.324628Z","closed_at":"2026-02-16T21:52:47.324628Z","close_reason":"readLastLines now parses the --- Processing header to only show output from the current run"}
{"id":"detergent-ell","title":"Make detergent status more granular for debugging","description":"Current status output isn't granular enough to debug issues like agent hangs. Proposed lifecycle states: 'change detected' (was 'pending'), 'agent started' (command invoked), 'agent succeeded' (exit 0), 'agent failed' (non-zero exit). Possibly also 'change committed'. Goal: be able to tell at a glance where in the pipeline a concern is stuck.","status":"closed","priority":2,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:21:23.176741Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:25:32.975088Z","closed_at":"2026-02-14T22:25:32.975088Z","close_reason":"Closed"}
{"id":"detergent-fo8","title":"dedupe","description":"deduplicate any code, including in tests. Don't remove test *coverage* though.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:26:18.396981Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:52:45.804202Z","closed_at":"2026-02-14T22:52:45.804202Z","close_reason":"Closed"}
{"id":"detergent-g2r","title":"Support .detergentignore for filtering trigger files","description":"## Problem\n\nEvery commit to a watched branch triggers the concern pipeline, even for changes that don't need review — beads metadata (.beads/), documentation, CI config, etc. This wastes agent API calls and adds latency for no value.\n\nFor example, committing a new bead issue (`.beads/issues.jsonl`) triggers the full concern chain even though no code changed.\n\n## Proposal\n\nAdd `.detergentignore` support, using `.gitignore` syntax, that filters commits before triggering concerns. If ALL changed files in a commit match ignore patterns, skip the commit entirely.\n\n### Behavior\n\n- File lives at repo root: `.detergentignore`\n- Uses `.gitignore` pattern syntax (globs, `!` negation, `#` comments, directory trailing `/`)\n- Applied during commit diffing in `processConcern()` — when checking new commits since `last-seen`, filter the diff file list against ignore patterns\n- If a commit touches ONLY ignored files → skip it (advance `last-seen`, no agent invocation)\n- If a commit touches ANY non-ignored files → process normally (full diff, including ignored files — we just use the ignore list for the trigger decision, not for filtering the diff content)\n- Log skipped commits similarly to `[skip ci]` handling\n\n### Example `.detergentignore`\n\n```\n# Beads issue tracker metadata\n.beads/\n\n# Documentation\ndocs/\n*.md\n!README.md\n\n# CI/CD\n.github/\n.gitlab-ci.yml\n\n# Editor/IDE\n.vscode/\n.idea/\n```\n\n### Implementation notes\n\n- Go has `github.com/sabhiram/go-gitignore` for `.gitignore` pattern matching\n- The skip logic should live near the existing `[skip ci]` / `[detergent skip]` marker handling in `processConcern()`\n- The ignore file should be read from the watched branch HEAD (not the worktree), so it reflects the repo's current config\n- Cache the parsed ignore file per poll cycle (not per commit) for performance\n\n### Edge cases\n\n- `.detergentignore` doesn't exist → no filtering (current behavior)\n- Commit modifies `.detergentignore` itself → process it (meta-change, worth reviewing)\n- Merge commits with mixed ignored/non-ignored files → process (conservative)","status":"closed","priority":2,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-18T13:20:29.296618Z","created_by":"Daniel Jones","updated_at":"2026-02-18T20:00:39.666324Z","closed_at":"2026-02-18T20:00:39.666324Z","close_reason":"Implemented .detergentignore support with go-gitignore library"}
{"id":"detergent-i3n","title":"releases","description":"Copy the strategy for releasing from https://github.com/re-cinq/claudit. We want patch revisions to get bumped, and releases for all architectures to be pushed to GitHub releases. There should be GitHub Actions that run the tests, and linting and stuff.","status":"closed","priority":3,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T08:14:54.550821Z","created_by":"Daniel Jones","updated_at":"2026-02-15T13:41:39.934634Z","closed_at":"2026-02-15T13:41:39.934634Z","close_reason":"Already implemented: CI pipeline (lint, test, build, integration, auto-release), GoReleaser config, bump-version workflow all in place. v0.0.1 released successfully."}
{"id":"detergent-i48","title":"commits","description":"I don't think I've seen detergent actually make any commits as a result of agent action. Can you investigate this? Do we have any proper end-to-end integration tests that really prove that it all works?","status":"closed","priority":1,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T07:12:23.486901Z","created_by":"Daniel Jones","updated_at":"2026-02-15T07:23:26.760297Z","closed_at":"2026-02-15T07:23:26.760297Z","close_reason":"Fixed: invokeAgent now pipes context to stdin so claude -p receives the actual prompt. Added test verifying stdin piping."}
{"id":"detergent-j57","title":"rename skill","description":"We should prolly namespace the skill to be /detergent/rebase. I don't know if that's descriptive enough of the outcome though... Rebasing is the implementation method, but really the user is 'getting changes' or something.\n\n","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T15:45:23.938526Z","created_by":"Daniel Jones","updated_at":"2026-02-15T16:33:37.450661Z","closed_at":"2026-02-15T16:33:37.450661Z","close_reason":"Renamed skill from /rebase to /detergent-rebase, updated hint and description"}
{"id":"detergent-kh1","title":"license","description":"Adopt the AI Native Application License - https://github.com/re-cinq/ai-native-application-license. Link to the repo containing the license in the README, as well as to our LICENSE file itself.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T06:51:38.618766Z","created_by":"Daniel Jones","updated_at":"2026-02-15T07:24:26.541976Z","closed_at":"2026-02-15T07:24:26.541976Z","close_reason":"Closed"}
{"id":"detergent-lie","title":"install script","description":"Make an install bash script that can be run via curl, as per https://github.com/re-cinq/claudit. We should also test this script so we know that it works.","status":"closed","priority":3,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T08:16:13.230377Z","created_by":"Daniel Jones","updated_at":"2026-02-15T14:21:10.255097Z","closed_at":"2026-02-15T14:21:10.255097Z","close_reason":"Added Docker-based install script test and CI job. Install script already existed; improved shebang and added usage header.","dependencies":[{"issue_id":"detergent-lie","depends_on_id":"detergent-i3n","type":"blocks","created_at":"2026-02-15T08:16:13.231111Z","created_by":"Daniel Jones"}]}
{"id":"detergent-lqr","title":"change github org","description":"I'll move this to the re-cinq github org. Can you change all the packages?","status":"closed","priority":1,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:12:41.083048Z","created_by":"Daniel Jones","updated_at":"2026-02-15T10:23:04.308634Z","closed_at":"2026-02-15T10:23:04.308634Z","close_reason":"Renamed module from github.com/fission-ai/detergent to github.com/re-cinq/detergent across all 15 Go files, goreleaser, Makefile, README, and install script. 75/75 tests pass."}
{"id":"detergent-nus","title":"Spike: Test creack/pty interactive mode for streaming agent output","description":"## Problem\n\nCurrent `invokeAgent()` runs `claude -p` (print/pipe mode) with a PTY allocated for stdout/stderr via `creack/pty`. Despite the PTY, Claude Code buffers output internally in `-p` mode, so logs arrive in chunks rather than streaming. The comment in engine.go:579 acknowledges this:\n\n\u003e \"Claude Code batches its output internally regardless of TTY detection, so logs appear in chunks rather than streaming line-by-line.\"\n\nThis makes `detergent logs -f` and `detergent status -f` less useful — you can't watch the agent work in real-time.\n\n## Proposed Approach: Interactive Mode via Existing creack/pty\n\nDrop `-p` flag and run Claude Code in **normal interactive mode** inside the PTY we already allocate. Claude's TUI renders to the PTY in real-time with token-level streaming.\n\n### How it would work\n\n1. Don't pass `-p` to claude — run it interactively\n2. Send the concern prompt via PTY stdin (write to ptmx) instead of `strings.NewReader`\n3. Read streaming output from PTY master (ptmx) — this already happens via `io.Copy`\n4. Detect completion by scanning output for Claude's idle prompt `❯ ` (or similar marker)\n5. Kill the process or send `/exit` when done\n\n### Key unknowns to test (this is a spike)\n\n- Does Claude Code actually stream token-by-token when running interactively in a PTY without a human attached? (Gas Town uses SIGWINCH wake trick to ensure this — may be needed)\n- What does the raw PTY output look like? ANSI escape codes, cursor movements, spinner artifacts, TUI chrome — how much stripping is needed for clean logs?\n- Can we reliably detect the idle prompt `❯ ` from the PTY output stream?\n- How do we handle Claude's initial startup (loading message, etc.) before the prompt is ready?\n- Does `--dangerously-skip-permissions` work without `-p`?\n- Performance: how does startup time compare to `-p` mode?\n\n### Alternatives considered\n\n1. **`--output-format stream-json`** (with `-p`): Tested. Streams at event/turn granularity, not token granularity. The `assistant` event contains the full response text in one JSON blob. Requires `--verbose` for useful events. Adds JSON parsing complexity. Undocumented/unstable format. Good enough for turn-level progress but not true streaming.\n\n2. **tmux** (Gas Town's approach): Full interactive session management. Gas Town runs Claude as the initial process of a detached tmux session, sends input via `send-keys`, reads output via `capture-pane`, wakes detached sessions with SIGWINCH resize trick. Gives multi-turn capability, `tmux attach` for debugging. But it's an external dependency not pre-installed on macOS, and is overkill for detergent's single-shot concern model.\n\n3. **Stay with current approach**: `-p` mode with PTY for stdout. Works, but logs are chunky.\n\n### Gas Town reference\n\nGas Town (github.com/steveyegge/gastown) solves this with tmux as the PTY layer. Key patterns worth borrowing even without tmux:\n\n- **SIGWINCH wake**: Detached PTY sessions may not process stdin until a terminal event occurs. Gas Town triggers `resize-pane -y -1` then `+1` to wake Claude's event loop. We may need an equivalent — write something to the PTY, or send SIGWINCH directly to the claude process.\n- **Prompt detection**: Gas Town scans `capture-pane` output for `❯ ` prefix to detect idle state. We'd scan PTY output instead.\n- **Send Enter separately**: Gas Town sends text via `send-keys -l` (literal), waits 500ms debounce, then sends Enter as a separate command. Our PTY equivalent: write prompt text to ptmx, sleep, write `\\n`.\n\n### Definition of done\n\nWrite a standalone Go test (or small binary) that:\n1. Launches `claude` (without `-p`) in a creack/pty\n2. Sends a simple prompt via the PTY\n3. Captures output and prints it line-by-line as it arrives (proving streaming works)\n4. Detects when Claude returns to the idle prompt\n5. Documents what the raw output looks like (ANSI codes, etc.)\n6. Determines whether SIGWINCH wake is needed\n\nResult should be a clear go/no-go for this approach, with findings documented.","status":"open","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-17T21:50:03.053839Z","created_by":"Daniel Jones","updated_at":"2026-02-17T21:50:37.517273Z"}
{"id":"detergent-o4f","title":"default config","description":"All commands that take the path of a detergent YAML config file should default to detergent.yaml. We should probably change any positional file path arguments to be named (-p and --path?)","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T06:59:38.295817Z","created_by":"Daniel Jones","updated_at":"2026-02-15T07:34:18.739487Z","closed_at":"2026-02-15T07:34:18.739487Z","close_reason":"Closed"}
{"id":"detergent-pi8","title":"detergent ignore","description":"we should probably allow for users to indicate that they don't want detergent to process a master branch commit. IIRC there's some convention about [SKIPCI] or something. Could we do that, and also one specific for detergent? And then if either is present, we don't process the commit?","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:15:09.218191Z","created_by":"Daniel Jones","updated_at":"2026-02-15T10:24:37.914126Z","closed_at":"2026-02-15T10:24:37.914126Z","close_reason":"Added skip marker support. Commits with [skip ci], [ci skip], [skip detergent], or [detergent skip] are skipped. All 75 tests pass."}
{"id":"detergent-r30","title":"graph to list","description":"To simplify things for now, let's change the UX so the chain of concerns is an ordered list, and not a graph. That means we don't need the 'watches' key in the YAML any more, and simplifies things. However, inside the app, I'd like it to remain modelled as a graph so we can add this feature back in later as a breaking change and major revision. Once done the README will need updating.","status":"closed","priority":1,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:54:00.575066Z","created_by":"Daniel Jones","updated_at":"2026-02-15T11:06:10.830309Z","closed_at":"2026-02-15T11:06:10.830309Z","close_reason":"Concerns now defined as ordered list. First watches settings.watches (default 'main'), each subsequent watches the previous. Explicit watches still accepted for backward compat. Internal graph model preserved. 75/75 tests pass."}
{"id":"detergent-rsk","title":"Deduplicate file existence check patterns","description":"Create ReadIfExists helper in internal/fsutil to consolidate os.IsNotExist checks found in engine/state.go (2x), engine/engine.go, and cli/logs.go.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:05:40.60531Z","created_by":"Daniel Jones","updated_at":"2026-02-15T10:24:58.656665Z","closed_at":"2026-02-15T10:24:58.656665Z","close_reason":"Premature abstraction. These are 2-3 line idiomatic Go patterns (MkdirAll+WriteFile, os.IsNotExist, fmt.Errorf). Creating helpers adds indirection without meaningful benefit at this codebase size."}
{"id":"detergent-sqf","title":"check test coverage","description":"make sure we've got test coverage for all the new features","notes":"Coverage assessment complete. 64 acceptance tests pass. Key gaps: (1) New granular states (change_detected, agent_running, committing) have zero test coverage, (2) statusline normalization edge cases partially tested, (3) rebaseHint logic untested, (4) status --follow flag untested, (5) install command has 0% coverage, (6) config validation edge cases (duplicate names, empty concerns, invalid durations) not tested. No unit tests exist - all testing is acceptance/integration.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:23:50.746334Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:32:30.791942Z","closed_at":"2026-02-14T22:32:30.791942Z","close_reason":"Audit complete - gaps documented, follow-up issue to be created for writing tests"}
{"id":"detergent-t2x","title":"Gemini CLI statusline integration","description":"Add detergent statusline support for Gemini CLI. Statusline feature still in development. Statusline request: https://github.com/google-gemini/gemini-cli/issues/8191 — Skills status bar integration (in progress): https://github.com/google-gemini/gemini-cli/issues/15692","status":"closed","priority":3,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-15T16:50:44.324983Z","created_by":"Daniel Jones","updated_at":"2026-02-17T09:03:20.348251Z","closed_at":"2026-02-17T09:03:20.348251Z","close_reason":"Gemini CLI has no external statusline API. Issue #15692 was an internal-only skill count feature, not extensible to third parties."}
{"id":"detergent-t90","title":"Deduplicate WriteFile with MkdirAll pattern","description":"Create WriteFileWithDir helper in internal/fsutil for MkdirAll + WriteFile pattern. Found 5+ occurrences in engine/state.go, engine/engine.go, and cli/install.go.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T10:05:41.487719Z","created_by":"Daniel Jones","updated_at":"2026-02-15T10:24:58.645676Z","closed_at":"2026-02-15T10:24:58.645676Z","close_reason":"Premature abstraction. These are 2-3 line idiomatic Go patterns (MkdirAll+WriteFile, os.IsNotExist, fmt.Errorf). Creating helpers adds indirection without meaningful benefit at this codebase size."}
{"id":"detergent-tda","title":"Add PTY support to invokeAgent for real-time log tailing","description":"Claude CLI buffers stdout when writing to a file (non-TTY). This means detergent status -f can't show real-time agent output - logs only appear after the agent finishes. Fix by using a PTY (e.g. creack/pty) in invokeAgent so the child process thinks it's writing to a terminal and uses line buffering instead.","status":"closed","priority":3,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-15T09:08:39.582521Z","created_by":"Daniel Jones","updated_at":"2026-02-15T15:57:10.727234Z","closed_at":"2026-02-15T15:57:10.727234Z","close_reason":"PTY support added to invokeAgent. Stdout/stderr now use a PTY so agents see a terminal and line-buffer output. Stdin stays as a pipe for proper EOF."}
{"id":"detergent-tin","title":"Write tests for untested functionality","description":"Coverage audit (detergent-sqf) found these gaps: (1) Granular lifecycle states (change_detected, agent_running, committing) - zero coverage, (2) Statusline normalization (idle+caught_up→noop, idle+behind→pending), (3) rebaseHint logic, (4) status --follow flag, (5) install command, (6) config validation edge cases. See detergent-sqf notes for full details.","status":"closed","priority":3,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-14T22:32:39.177206Z","created_by":"Daniel Jones","updated_at":"2026-02-14T22:54:55.107873Z","closed_at":"2026-02-14T22:54:55.107873Z","close_reason":"Closed"}
{"id":"detergent-x6a","title":"OpenCode statusline integration","description":"Add detergent statusline support for OpenCode. Community opencode-status-line project exists (https://github.com/markwilkening21/opencode-status-line). Native StatusLine hook feature request: https://github.com/anomalyco/opencode/issues/8619","status":"closed","priority":2,"issue_type":"feature","owner":"daniel@ajps.limited","created_at":"2026-02-15T16:50:42.977658Z","created_by":"Daniel Jones","updated_at":"2026-02-17T09:03:20.242005Z","closed_at":"2026-02-17T09:03:20.242005Z","close_reason":"OpenCode doesn't yet support external statusline hooks. Feature request #8619 is open with PR #13885 in progress — revisit when it lands."}
{"id":"detergent-z59","title":"separate help text","description":"the help for commands should be split into two - one for humans, and one for agents. I don't think humans will want to run statusline, statusline-data. Also, the help text makes reference to a graph, and it's a chain now.","status":"closed","priority":2,"issue_type":"task","owner":"daniel@ajps.limited","created_at":"2026-02-15T16:04:31.08156Z","created_by":"Daniel Jones","updated_at":"2026-02-15T16:28:47.299211Z","closed_at":"2026-02-15T16:28:47.299211Z","close_reason":"Hidden statusline/statusline-data from help, fixed graph→chain wording throughout CLI"}
